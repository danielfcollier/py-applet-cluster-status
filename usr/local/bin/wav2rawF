#!/bin/bash

ARGS=1 #numero minimo de args. existe um arg. opcional
E_BADARGS=65
E_NODIR=66

if [[ $# -lt $ARGS || $# -gt $((ARGS+1)) ]]
then
  echo "Uso: `basename $0` diretorio [-v]"
  exit $E_BADARGS
fi

#Alerta de uso incorreto do segundo parametro.
if [[ -n $2  && "$2" != "-v" ]]
then
  echo "Uso: `basename $0` diretorio [-v]"
  exit $E_BADARGS
fi

#Testa existencia do diretorio
if [ ! -d "$1" ]
then
  echo "Dir \"$1\" nao existe."
  exit $E_NODIR
fi  

#Converte de wav para raw.
conta=0
LIST=`ls $1/*.wav`
for i in $LIST; do
    sox $i ${i%wav}raw
    conta=$((conta+1))
done

#Conta os arquivos convertidos e imprime na tela(OPCIONAL).
if [ "$2" = "-v" ]; then
    echo "Arquivos convertidos:" $conta
fi
